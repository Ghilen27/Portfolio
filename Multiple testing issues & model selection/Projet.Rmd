---
title: "Modélisation statistique des données complexes"
author: "Ghilen TAGNIT HAMMOU"
date: "2024-10-06"
output: 
  pdf_document: 
    toc: yes
fontsize: 11pt
subtitle: \textit{Rapport TP}
---

\newpage

# Partie I sur le TP 1 (Multiple testing)

\vspace{5mm}

# 2. Multiple testing and p-values

\vspace{5mm}

## Empirical Type I error

\vspace{5mm}

-- Question 1 :

```{r 1}
n <- 50
Y <- sample(0:1, n, replace=T)

```

\vspace{3mm}

-- Question 2 :

```{r 2}
n <- 50
p <- 100
X <- matrix(rnorm(n*p, 0, 1), ncol = p)

```

\vspace{3mm}

-- Question 3 : On effectue un test de Student pour comparer les colonnes de X (variables quantitatives) avec Y (variable binaire qualitative). Ce test nous permet d'identifier les variables liées à Y.

\vspace{3mm}

-- Question 4 :

```{r 3}
pvaleurs <- c()
i = 1
while (i <= p){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "blue")

```

On ne peut rien dire pour l'instant mais on observera que lorsque p augmente, les p-valeurs sont uniformément distribuées sur [0,1].

\vspace{3mm}

-- Question 5 :

```{r 4}
alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de faux positifs au risque de 5% est", nb)

```

\vspace{3mm}

-- Question 6 :

```{r 5}
cat("L'erreur empirique de type I est", nb/p)

```

La valeur observée est assez proche de $\alpha$ = 0,05.

\vspace{3mm}

-- Question 7 :

- Pour p = 1000 :

```{r 6}
# Pour  = 1000

n <- 50
Y <- sample(0:1,n,replace=T)

p<- 1000
X <- matrix(rnorm(n*p, 0, 1), ncol = p)

pvaleurs <- c()
i = 1
while (i <= p){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "red") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de faux positifs au risque de 5% est", nb)

cat("L'erreur empirique de type I est", nb/p)

```

L'histogramme montre que les p-valeurs sont plus équitablement réparties sur [0,1] par rapport au cas où p = 100. L'erreur empirique de type I est environ égale à $\alpha$ = 0,05.

\vspace{3mm}

- Pour p = 10000 :

```{r 7}
n <- 50
Y <- sample(0:1,n,replace=T)

p<- 10000
X <- matrix(rnorm(n*p, 0, 1), ncol = p)

pvaleurs <- c()
i = 1
while (i <= p){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "green") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de faux positifs au risque de 5% est", nb)

cat("L'erreur empirique de type I est", nb/p)

```

L'histogramme montre que les p-valeurs sont plus équitablement réparties sur [0,1] par rapport aux cas où p = 100 et p = 1000. L'erreur empirique de type I est environ égale à $\alpha$ = 0,05.

\vspace{5mm}

## Empirical Power of test

\vspace{5mm}

-- Question 8.a :

```{r 8}
n = 50
p1 = 100
Y <- sample(0:1, n, replace=T)

X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, 3*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}
minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "yellow")

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1) 

```

Les p-valeurs sont très proches de 0 (très majoritairement en-dessous de 0,05). Ce test est très puissant.

\vspace{3mm}

-- Question 8.b :

```{r 9}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, 2*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col="pink") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)



```

Les p-valeurs sont très proches de 0 mais peuvent largement dépasser 0,05. Ce test est très puissant.

\vspace{3mm}

-- Question 8.c :

```{r 10}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "orange") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont davantage réparties entre 0 et 1 mais restent proches de 0. La puissance du test a fortement diminué par rapport aux cas précédents.

\vspace{3mm}

-- Question 8.d :

```{r 11}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, 3*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "black") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont davantage réparties entre 0 et 1 mais restent proches de 0. La puissance du test diminue encore par rapport aux cas précédents.

\vspace{3mm}

-- Question 8.e :

```{r 12}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, 2*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "purple") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont davantage réparties entre 0 et 1 mais restent proches de 0. La puissance du test diminue encore par rapport aux cas précédents.

\vspace{3mm}

-- Question 8.f :

```{r 13}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "brown") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont encore plus réparties entre 0 et 1. La puissance du test est très petite.

\vspace{3mm}

-- Question 8.g :

Pour les questions 8.a, 8.b et 8.c, la probabilité que X dépende de Y est plus importante (= 0,7) que les questions 8.d, 8.e et 8.f (= 0,3). Ceci explique les valeurs plus élevées du nombre de tests significatifs et de la puissance de test pour les premières questions. Plus le coefficient devant Y est grand dans la loi normale qui compose X, plus la puissance de test est élevée.

\vspace{3mm}

-- Question 8.h :

1) Pour n = 100 :

- Cas 8.a :

```{r 14}
n = 100
p1 = 100
Y <- sample(0:1, n, replace=T)

X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, 3*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}
minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "yellow")

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont très proches de 0 (très majoritairement en-dessous de 0,05). Ce test est très puissant.

\vspace{3mm}

- Cas 8.b :

```{r 15}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, 2*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col="pink") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont très proches de 0 (très majoritairement en-dessous de 0,05). Ce test est très puissant.

\vspace{3mm}

- Cas 8.c :

```{r 16}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "orange")

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont davantage réparties entre 0 et 1 mais restent très proches de 0. Ce test est très puissant, on observe une légère diminution de la puissance.

\vspace{3mm}

- Cas 8.d :

```{r 17}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, 3*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "black")

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont davantage réparties entre 0 et 1 mais restent proches de 0. La puissance du test reste élevée.

\vspace{3mm}

- Cas 8.e :

```{r 18}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, 2*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "purple")

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont davantage réparties entre 0 et 1 mais restent proches de 0. La puissance du test diminue.

\vspace{3mm}

- Cas 8.f :

```{r 19}

X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "brown") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont encore plus réparties entre 0 et 1. La puissance du test diminue fortement mais reste plus grande par rapport à n = 50. 

\vspace{3mm}

2) Pour n = 200 :

- Cas 8.a :

```{r 20}
n = 200
p1 = 100
Y <- sample(0:1, n, replace=T)

X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, 3*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}
minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "yellow") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont très proches de 0 (très majoritairement en-dessous de 0,05). Ce test est très puissant.

\vspace{3mm}

- Cas 8.b :

```{r 21}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, 2*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col="pink") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont très proches de 0 (très majoritairement en-dessous de 0,05). Ce test est très puissant.

\vspace{3mm}

- Cas 8.c :

```{r 22}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X[,j] <- Z*rnorm(n, Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "orange")

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs restent proches de 0. Ce test est très puissant.

\vspace{3mm}

- Cas 8.d :

```{r 23}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, 3*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "black") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs restent proches de 0. Ce test est très puissant.

\vspace{3mm}

- Cas 8.e :

```{r 24}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, 2*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}


pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "purple")

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont davantage réparties entre 0 et 1 mais restent très proches de 0. On observe une lègère diminution de la puissance du test.

\vspace{3mm}

- Cas 8.f :

```{r 25}
X <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X[,j] <- Z*rnorm(n, Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

pvaleurs <- c()
i = 1
while (i <= p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs = c(pvaleurs, tp)
  i = i + 1
}

minimum <- min(pvaleurs)
minimum
maximum <- max(pvaleurs)
maximum

hist(pvaleurs, col = "brown") 

alpha = 0.05
nb = length(which(pvaleurs < alpha))
cat("Le nombre de tests significatifs est", nb)

cat("La puissance du test est", nb/p1)

```

Les p-valeurs sont encore plus réparties entre 0 et 1. La puissance du test diminue fortement mais reste supérieure aux cas n = 50 et n = 100. \newline

De manière générale, la puissance du test dépend de la valeur de n choisie. Lorsque n est grand, les tests sont plus puissants et les p-valeurs sont plus petites (moins réparties dans [0, 1]).

\vspace{5mm}

## Mixture of $H_0$ and $H_1$

\vspace{5mm}

```{r 26}
n = 50
p1 = 100

Y <- sample(0:1, n, replace=T)

X1 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X1[,j] <- Z*rnorm(n, 3*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

X2 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X2[,j] <- Z*rnorm(n, 2*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

X3 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.7)*1
  X3[,j] <- Z*rnorm(n, Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

X4 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X4[,j] <- Z*rnorm(n, 3*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

X5 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X5[,j] <- Z*rnorm(n, 2*Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

X6 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  Z <- (runif(n)<0.3)*1
  X6[,j] <- Z*rnorm(n, Y, 1) + (1-Z)*rnorm(n, 0, 1)
  j = j + 1
}

X7 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  X7[,j] <- rnorm(n, 0, 1)
  j = j + 1
}


X8 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  X8[,j] <- rnorm(n, 0, 1)
  j = j + 1
}


X9 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  X9[,j] <- rnorm(n, 0, 1)
  j = j + 1
}


X10 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  X10[,j] <- rnorm(n, 0, 1)
  j = j + 1
}


X11 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  X11[,j] <- rnorm(n, 0, 1)
  j = j + 1
}


X12 <- matrix(0.0, nrow = n, ncol = p1)
j = 1
while (j <= p1){
  X12[,j] <- rnorm(n, 0, 1)
  j = j + 1
}


X = data.frame(X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12)

```

Les 6 premières colonnes de X (X1 à X6) sont liées à Y par construction, contrairement aux 6 dernières colonnes (X7 à X12).

\vspace{3mm}

-- Question 9 :

```{r 27}
pvaleurs1 <- c()
i = 1
while (i <= 6*p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs1 = c(pvaleurs1, tp)
  i = i + 1
}

minimum <- min(pvaleurs1)
minimum
maximum <- max(pvaleurs1)
maximum

hist(pvaleurs1, col = "cyan") 

```

L'histogramme obtenu est cohérent avec les questions précédentes, les p-valeurs sont proches de 0. Nous ommes dans le cas où les variables sont liées à Y.

\vspace{3mm}

-- Question 10 :

```{r 28}
pvaleurs2 <- c()
i = 6*p1+1
while (i <= 12*p1){
  t <- t.test(X[which(Y==1), i], X[which(Y==0), i])
  tp = t$p.value
  pvaleurs2 = c(pvaleurs2, tp)
  i = i + 1
}

minimum <- min(pvaleurs2)
minimum
maximum <- max(pvaleurs2)
maximum


hist(pvaleurs2, col="magenta") 

```

Les p-valeurs sont bien uniformément distribuées sur [0,1]. Nous sommes dans le cas où les variables sont indépendantes de Y.

\vspace{3mm}

-- Question 11 :

```{r 29}
pval = pvaleurs1
pval = rbind(pval, pvaleurs2)
minimum <- min(pval)
minimum
maximum = max(pval)
maximum

hist(pval, col="beige")

```

Globalement, les p-valeurs sont petites et uniformément distribuées à partir d'un certains seuil.

\vspace{3mm}

-- Question 12 :

```{r 30}
alpha = 0.05

S = length(which(pvaleurs1 < alpha))
cat("Le nombre de tests significatifs sous H1 ou vrais positifs  est", S)

V = length(which(pvaleurs2 < alpha))
cat("Le nombre de tests significatifs sous H0 ou faux positifs est", V)

R = length(which(pval < alpha)) 
cat("Le nombre de tests significatifs est", R)

p = length(pval)
cat("Le nombre de variables considérées est", p)

p0 = length(pvaleurs2)
cat("Le nombre théorique de variables indépendantes de Y est", p0)

FDR = V/R
cat("La proportion de faux positifs parmi l'ensemble des tests significatifs est", FDR)

```

On a choisi comme risque $\alpha$ = 0,05. Les variables p et p0 sont fixées au départ, les autres variables dépendent de la simulation.

\vspace{5mm}

# 3. Adjusted p-values

\vspace{5mm}

-- Question 1.a :

- Méthode de Bonferroni :

```{r 31}
adj.bon <- p.adjust(pval, method = "bonferroni")
minimum <- min(adj.bon)
minimum
maximum = max(adj.bon)
maximum

hist(adj.bon) 

alpha = 0.05

S = length(which(adj.bon[seq(1, 6*p1)] < alpha))
cat("Le nombre de tests significatifs sous H1 ou vrais positifs  est", S)

V = length(which(adj.bon[seq(6*p1, 12*p1)] < alpha))
cat("Le nombre de tests significatifs sous H0 ou faux positifs est", V)

R = length(which(adj.bon < alpha)) 
cat("Le nombre de tests significatifs est", R)

p = length(adj.bon)
cat("Le nombre de variables considérées est", p)

p0 = length(pvaleurs2)
cat("Le nombre théorique de variables indépendantes de Y est", p0)

FDR = V/R
cat("La proportion de faux positifs parmi l'ensemble des tests significatifs est", FDR)

```

On obtient un FDR plus petit par rapport au cas où les p-valeurs ne sont pas ajustées.

\vspace{3mm}

- Méthode de Holms :

```{r 32}
adj.holm <- p.adjust(pval, method = "holm")
minimum <- min(adj.holm)
minimum
maximum = max(adj.holm)
maximum

hist(adj.holm) 

alpha = 0.05

S = length(which(adj.holm[seq(1, 6*p1)] < alpha))
cat("Le nombre de tests significatifs sous H1 ou vrais positifs  est", S)

V = length(which(adj.holm[seq(6*p1, 12*p1)] < alpha))
cat("Le nombre de tests significatifs sous H0 ou faux positifs est", V)

R = length(which(adj.holm < alpha)) # S + V
cat("Le nombre de tests significatifs est", R)

p = length(adj.holm)
cat("Le nombre de variables considérées est", p)

p0 = length(pvaleurs2)
cat("Le nombre théorique de variables indépendantes de Y est", p0)

FDR = V/R
cat("La proportion de faux positifs parmi l'ensemble des tests significatifs est", FDR)

```

On obtient un FDR plus petit par rapport au cas où les p-valeurs ne sont pas ajustées.

\vspace{3mm}

- Méthode de Benjamini-Hochberg :

```{r 33}
adj.bh <- p.adjust(pval, method = "holm")
minimum <- min(adj.bh)
minimum
maximum = max(adj.bh)
maximum

hist(adj.bh) 

alpha = 0.05

S = length(which(adj.bh[seq(1, 6*p1)] < alpha))
cat("Le nombre de tests significatifs sous H1 ou vrais positifs  est", S)

V = length(which(adj.bh[seq(6*p1, 12*p1)] < alpha))
cat("Le nombre de tests significatifs sous H0 ou faux positifs est", V)

R = length(which(adj.bh < alpha)) # S + V
cat("Le nombre de tests significatifs est", R)

p = length(adj.bh)
cat("Le nombre de variables considérées est", p)

p0 = length(pvaleurs2)
cat("Le nombre théorique de variables indépendantes de Y est", p0)

FDR = V/R
cat("La proportion de faux positifs parmi l'ensemble des tests significatifs est", FDR)

```

On obtient un FDR plus petit par rapport au cas où les p-valeurs ne sont pas ajustées.

\vspace{3mm}

- Méthode de Sidak :

```{r 34}
sidak <- function(pval){
  p <- length(pval)
  return(1 - (1 - pval)**p)
}

adj.sidak <- sidak(pval)
minimum <- min(adj.sidak)
minimum
maximum = max(adj.sidak)
maximum

hist(adj.sidak) 

alpha = 0.05

S = length(which(adj.sidak[seq(1, 6*p1)] < alpha))
cat("Le nombre de tests significatifs sous H1 ou vrais positifs  est", S)

V = length(which(adj.sidak[seq(6*p1, 12*p1)] < alpha))
cat("Le nombre de tests significatifs sous H0 ou faux positifs est", V)

R = length(which(adj.sidak < alpha)) # S + V
cat("Le nombre de tests significatifs est", R)

p = length(adj.sidak)
cat("Le nombre de variables considérées est", p)

p0 = length(pvaleurs2)
cat("Le nombre théorique de variables indépendantes de Y est", p0)

FDR = V/R
cat("La proportion de faux positifs parmi l'ensemble des tests significatifs est", FDR)

```

On obtient un FDR plus petit par rapport au cas où les p-valeurs ne sont pas ajustées. \newline

Les différentes valeurs de FDR simulées selon les méthodes considérées sont plus petites car les p-valeurs sont ajustées.

\vspace{3mm}

-- Question 1.b :

```{r 35}
plot(adj.bon, adj.holm) 
plot(adj.bon, adj.bh) 
plot(adj.bon, adj.sidak) 
plot(adj.holm, adj.bh) 
plot(adj.holm, adj.sidak) 
plot(adj.bh, adj.sidak) 

```

On a affiché 6 graphiques pour comparer 2 à 2 la répartition des p-valeurs ajustées par les 4 méthodes ci-dessus. 

En comparant la méthode Bonferroni à la méthode Holms, nous obtenons presque une représentation linéaire (droite).

En comparant la méthode Bonferroni à la méthode Benjamini-Hochberg, nous obtenons presque une représentation linéaire (droite). 

En comparant la méthode Bonferroni à la méthode Sidak, nous obtenons presque une représentation linéaire (droite) sauf vers l'abscisse 1. 

En comparant la méthode Holms à la méthode Benjamini-Hochberg, nous obtenons presque une représentation linéaire (droite). 

En comparant la méthode Holms à la méthode Sidak, nous obtenons presque une représentation linéaire (droite) sauf vers l'abscisse 1. 

En comparant la méthode Benjamini-Hochberg à la méthode Sidak, nous obtenons presque une représentation linéaire (droite) sauf vers l'abscisse 1.

\vspace{3mm}

-- Question 1.c : Installation de la librairie qvalue

```{r 36}
library(qvalue)

```

\vspace{3mm}

-- Question 1.d :

```{r 37}
qvalcom <- qvalue(pval)
qval <- qvalcom$qvalues
hist(qval)

alpha = 0.05

S = length(which(qval[seq(1, 6*p1)] < alpha))
cat("Le nombre de tests significatifs sous H1 ou vrais positifs  est", S)

V = length(which(qval[seq(6*p1, 12*p1)] < alpha))
cat("Le nombre de tests significatifs sous H0 ou faux positifs est", V)

R = length(which(qval < alpha)) # S + V
cat("Le nombre de tests significatifs est", R)

p = length(qval)
cat("Le nombre de variables considérées est", p)

p0 = length(pvaleurs2)
cat("Le nombre théorique de variables indépendantes de Y est", p0)

FDR = V/R
cat("La proportion de faux positifs parmi l'ensemble des tests significatifs est", FDR)

plot(qval, pval) 
plot(qval, adj.bon) 
plot(qval, adj.holm) 
plot(qval, adj.bh) 
plot(qval, adj.sidak) 

```

La valeur FDR calculée pour les q-valeurs est plus élevée par rapport à celle des p-valeurs et des p-valeurs ajustées par les différentes méthodes ci-dessus.

En comparant les q-valeurs aux p-valeurs, nous obtenons une courbe qui peut ressembler à une droite.

En comparant les q-valeurs à la méthode Bonferroni, nous obtenons une grande bande noire pour l'ordonnée 1 avec une tâche noire à l'origine.

En comparant les q-valeurs à la méthode Holms, nous observons une grande bande noire pour l'ordonnée 1 avec une tâche noire à l'origine.

En comparant les q-valeurs à la méthode Benjamini-Hochberg, nous observons une grande bande noire pour l'ordonnée 1 avec une tâche noire à l'origine.

En comparant les q-valeurs à la méthode Sidak, nous observons une grande bande noire pour l'ordonnée 1 avec une tâche noire à l'origine.

\vspace{3mm}

Question 2 :

```{r 38}
qvalcom <- qvalue(pval)$pi0
qvalcom

pi0est(pval, lambda = seq(0.05, 0.95, 0.05))

```

Dans notre cas, la valeur de $pi_0$ représente la proportion de variables (colonnes de X) indépendantes de Y et vaut 0,5. C'est la probabilité que $H_0$ soit vraie. cette valeur est surestimée par notre simulation.

\vspace{5mm}

#  4. Application to real data

\vspace{5mm}

```{r 39}
data_cancer <- read.csv(file="datacancer.csv", sep=",", dec=".", header= TRUE)
n = dim(data_cancer)[1]
p = dim(data_cancer)[2]

```

\vspace{3mm}

Question 1 :

```{r 40}
lim = 60
pval_quali = c()
for (i in 9:lim){
  CH = summary(table(data_cancer[,i],data_cancer$Surv12))
  pval_quali = c(pval_quali, CH$p.value)
}
pval_quali
length(pval_quali)

```

\vspace{3mm}

Question 2 :

```{r 41}
pval_quanti = c()
for (i in (lim+1):p){
  TS = t.test(data_cancer[,i]~data_cancer$Surv12)
  pval_quanti = c(pval_quanti, TS$p.value)
}

pval_quanti
length(pval_quanti)

```

\vspace{3mm}

Question 3 :

```{r 42}
ppval = c(pval_quali,pval_quanti)
adj.bon <- p.adjust(ppval, method = "bonferroni")
adj.holm <- p.adjust(ppval, method = "holm")
adj.bh <- p.adjust(ppval, method = "BH")
adj.sidak <- sidak(ppval)

alpha = 0.05

# sans ajustement, les colonnes sont:
colnames(data_cancer)[9:p][ppval  < alpha]

# avec Bonferroni les colonnes sont:
colnames(data_cancer)[9:p][adj.bon  < alpha] 

# avec Holms les colonnes sont:
colnames(data_cancer)[9:p][adj.holm < alpha] 

# avec BH les colonnes sont:
colnames(data_cancer)[9:p][adj.bh < alpha] 

# avec Sidak les colonnes sont:
colnames(data_cancer)[9:p][adj.sidak < alpha] 

```

La méthode de Benjamini-Hochberg renvoie un nombre plus important de variables qui peuvent expliquer la variable Surv12. Les autres méthodes renvoient les mêmes variables qui sont moins nombreuses. Les varaibles qui peuvent alors expliquer Surv12 sont CYFRA2_1_1_class, NBCYCLE_CT, NBINJ, Monocyte_Count, Neutrophil_Count, White_Blood_Cell_Count et CRP.

On peut faire de même pour la variable Surv6.

```{r 43}
lim = 60
pval_quali = c()
for (i in 9:lim){
  CH = summary(table(data_cancer[,i],data_cancer$Surv6))
  pval_quali = c(pval_quali, CH$p.value)
}
pval_quali
length(pval_quali)

pval_quanti = c()
for (i in (lim+1):p){
  TS = t.test(data_cancer[,i]~data_cancer$Surv6)
  pval_quanti = c(pval_quanti, TS$p.value)
}

pval_quanti
length(pval_quanti)

ppval = c(pval_quali,pval_quanti)
adj.bon <- p.adjust(ppval, method = "bonferroni")
adj.holm <- p.adjust(ppval, method = "holm")
adj.bh <- p.adjust(ppval, method = "BH")
adj.sidak <- sidak(ppval)

alpha = 0.05

# sans ajustement, les colonnes sont:
colnames(data_cancer)[9:p][ppval  < alpha]

# avec Bonferroni les colonnes sont:
colnames(data_cancer)[9:p][adj.bon  < alpha] 

# avec Holms les colonnes sont:
colnames(data_cancer)[9:p][adj.holm < alpha] 

# avec BH les colonnes sont:
colnames(data_cancer)[9:p][adj.bh < alpha] 

# avec Sidak les colonnes sont:
colnames(data_cancer)[9:p][adj.sidak < alpha] 

```

Les varaibles qui peuvent expliquer Surv6 selon les 4 méthodes d'ajustement sont NBCYCLE_CT, Neutrophil_Count et White_Blood_Cell_Count.

\vspace{5mm}

# Partie II sur le TP 2 (Model selection)

\vspace{5mm}

# 5. Classification model
